<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Examples</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link href="" rel="stylesheet">
    <style>
    html,
    body {
        width: 100%;
        height: 100%;
    }

    .container {
        width: 100%;
        height: 100%;
        display: flex;
    }

    .sidebar {
        width: 20%;
    }

    #map {
        width: 80%;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div>
                <input placeholder="Searchâ€¦" type="search" data-bind="textInput: query" autocomplete="off">
                <ul data-bind="foreach: filteredlocList">
                    <li data-bind="text: title, click: $parent.setLoc"></li>
                </ul>
            </div>
        </div>
        <div id="map">
        </div>
    </div>
    <script>
    var map;

    var markers = [];
    var locations = [
        { title: 'White Tower', location: { lat: 40.626446, lng: 22.948426 } },
        { title: 'Museum of Photography', location: { lat: 40.632874, lng: 22.935479 } },
        { title: 'Teloglion Fine Arts Foundation', location: { lat: 40.632854, lng: 22.941567 } },
        { title: 'War Museum of Thessaloniki', location: { lat: 40.624308, lng: 22.95953 } },
        { title: 'Jewish Museum of Thessaloniki', location: { lat: 40.635132, lng: 22.939538 } }
    ];

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 40.6401, lng: 22.9444 },
            zoom: 14
        });
        for (var i = 0; i < locations.length; i++) {
            // Get the position from the location array.
            var position = locations[i].location;
            var title = locations[i].title;
            // Create a marker per location, and put into markers array.
            var marker = new google.maps.Marker({
                position: position,
                title: title,
                map: map,
                animation: google.maps.Animation.DROP,
                id: i
            });
            markers.push(marker);
        };

        var Loc = function(data) {
            this.title = ko.observable(data.title);
            this.location = ko.observable(data.location);
        };

        var place = function(data) {
            this.name = ko.observable(data.name);
        };

        var stringStartsWith = function(string, startsWith) {
            string = string || "";
            if (startsWith.length > string.length)
                return false;
            return string.substring(0, startsWith.length) === startsWith;
        };

        var ViewModel = function() {
            var self = this;
            this.query = ko.observable('');
            this.locList = ko.observableArray('');
            this.filteredlocList = ko.computed(function() {
                var filter = self.query().toLowerCase();
                console.log(filter);
                var unwrappedLocList = ko.toJS(self.locList);
                if (!filter) {
                    return unwrappedLocList
                } else {
                    return ko.utils.arrayFilter(unwrappedLocList, function(item) {
                        return stringStartsWith(item.title.toLowerCase(), filter);
                    });
                }
            }, this);

            this.setLoc = function(clickedLoc) {
                var unwrappedLoc = ko.toJS(clickedLoc);
                var unwrappedLocList = ko.toJS(self.locList);
                for (var i = 0; i < unwrappedLocList.length; i++) {
                    if (unwrappedLoc.title == markers[i].title) {
                        markers[i].setAnimation(google.maps.Animation.BOUNCE);
                    }
                }
            };

        };
        var vm = new ViewModel();
        ko.applyBindings(vm);
        locations.forEach(function(locItem) {
            vm.locList.push(new Loc(locItem))
        });
    };
    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>
    <script async defer src="http://maps.google.com/maps/api/js?region=cn&language=zh-CN&key=AIzaSyBfkRj2brmbXXJ-hZORPHjUT_9G0sI8wEA&v=3&callback=initMap">
    </script>
    <script src="js/knockout-3.4.2.js"></script>

</body>

</html>